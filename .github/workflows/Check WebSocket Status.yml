name: Check WS (2095)

on:
  workflow_dispatch:

jobs:
  check-ws:
    runs-on: ubuntu-latest

    steps:
      - name: Test WS handshake on port 2095
        run: |
          set -e

          HOST="wdnm.cnmfangbinxingnmsl.workers.dev"
          URL="http://$HOST:2095/"

          STATUS=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "Host: $HOST" \
            -H "Connection: Upgrade" \
            -H "Upgrade: websocket" \
            -H "Sec-WebSocket-Version: 13" \
            -H "Sec-WebSocket-Key: SGVsbG9Xb3JsZA==" \
            "$URL")

          echo "WS HTTP status: $STATUS"

          if [ "$STATUS" != "101" ]; then
            echo "❌ WS handshake failed"
            exit 1
          fi

          echo "✅ WS handshake OK (101)"
