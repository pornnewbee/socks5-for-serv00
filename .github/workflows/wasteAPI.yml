name: Infinite Single-Workflow Trigger

on:
  workflow_dispatch:

permissions:
  actions: write
  contents: read

jobs:
  trigger_loop:
    runs-on: ubuntu-latest
    steps:
      - name: Infinite trigger loop
        run: |
          REPO="africadick/codespace"          # 目标仓库
          WORKFLOW_FILE="IP.yml"  # 目标 workflow 文件
          REF="main"                     # 分支
          TOKEN="${{ secrets.PERSONAL_ACCESS_TOKEN }}"

          echo "Starting infinite trigger loop for $REPO/$WORKFLOW_FILE..."

          while true; do
            echo "Triggering $REPO/$WORKFLOW_FILE at $(date)..."
            curl -s -X POST \
              -H "Accept: application/vnd.github+json" \
              -H "Authorization: Bearer $TOKEN" \
              https://api.github.com/repos/$REPO/actions/workflows/$WORKFLOW_FILE/dispatches \
              -d "{\"ref\":\"$REF\"}"
          done
