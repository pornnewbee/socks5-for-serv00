name: Cancel All Actions in Another Repo

on:
  workflow_dispatch:

jobs:
  cancel_all:
    runs-on: ubuntu-latest
    steps:
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Cancel all runs in target repo
        env:
          TARGET_OWNER: africadick
          TARGET_REPO: codespace
          PAT: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        run: |
          echo "Listing all running/pending workflow runs..."
          runs=$(curl -s -H "Authorization: token $PAT" \
            "https://api.github.com/repos/$TARGET_OWNER/$TARGET_REPO/actions/runs?status=in_progress,pending&per_page=100" \
            | jq -r '.workflow_runs[].id')

          for run_id in $runs; do
            echo "Cancelling run $run_id..."
            curl -s -X POST -H "Authorization: token $PAT" \
              "https://api.github.com/repos/$TARGET_OWNER/$TARGET_REPO/actions/runs/$run_id/cancel"
          done
