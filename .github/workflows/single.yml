name: Single Workflow

on:
  workflow_dispatch:

permissions:
  actions: write
  contents: read

jobs:
  trigger_once:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger target workflow once
        run: |
          REPO="africadick/codespace"      # 目标仓库
          WORKFLOW_FILE="IP.yml"           # 目标 workflow 文件
          REF="main"                       # 分支
          TOKEN="${{ secrets.PERSONAL_ACCESS_TOKEN }}"

          echo "Triggering $REPO/$WORKFLOW_FILE on ref $REF..."

          RESPONSE=$(curl -s -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $TOKEN" \
            https://api.github.com/repos/$REPO/actions/workflows/$WORKFLOW_FILE/dispatches \
            -d "{\"ref\":\"$REF\"}")

          echo "Response:"
          echo "$RESPONSE"
